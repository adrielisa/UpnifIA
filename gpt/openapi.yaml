openapi: 3.1.0
info:
  title: UpnifIA - API completa para Upnify CRM
  version: 1.0.1
  description: API REST para crear prospectos y consultar ventas desde GPT.
servers:
  - url: https://upnifia-production.up.railway.app
paths:
  /crear-prospecto-completo:
    post:
      summary: Crear prospecto en Upnify CRM
      operationId: crearProspecto
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [nombre, apellidos, correo]
              properties:
                nombre:
                  type: string
                apellidos:
                  type: string
                correo:
                  type: string
                  format: email
                telefono2:
                  type: string
                movil:
                  type: string
                empresa:
                  type: string
                puesto:
                  type: string
                calle:
                  type: string
                ciudad:
                  type: string
                idEstado:
                  type: string
                codigoPostal:
                  type: string
                titulo:
                  type: string
                sexo:
                  type: string
                  enum: [H, M]
                url:
                  type: string
                colonia:
                  type: string
                idMunicipio:
                  type: string
                facebook:
                  type: string
                twitter:
                  type: string
                skype:
                  type: string
                linkedIn:
                  type: string
                googlePlus:
                  type: string
                etiquetas:
                  type: string
      responses:
        '200':
          description: Prospecto creado exitosamente
  /consultar-prospectos:
    get:
      summary: Consultar prospectos del día
      operationId: consultarProspectos
      responses:
        '200':
          description: Lista prospectos
  /consultar-ventas:
    get:
      summary: Consultar reportes de ventas con filtros flexibles
      operationId: consultarVentas
      parameters:
        - name: agrupacion
          in: query
          schema:
            type: integer
            enum: [1, 2, 3, 4, 5, 6, 17]
            default: 1
          description: |
            Tipo de agrupación:
            - 1: Por ejecutivo
            - 2: Por grupo  
            - 3: Por línea
            - 4: Por origen
            - 5: Por país
            - 6: Por región
            - 17: Por industria
        - name: periodicidad
          in: query
          schema:
            type: integer
            enum: [1, 2, 3, 4, 5, 6]
            default: 4
          description: |
            Periodicidad del reporte:
            - 1: Semestral
            - 2: Trimestral
            - 3: Bimestral
            - 4: Mensual
            - 5: Quincenal
            - 6: Semanal
        - name: anio
          in: query
          schema:
            type: integer
            minimum: 2009
            maximum: 2025
            default: 2025
          description: Año a consultar (2009-2025)
        - name: impuestos
          in: query
          schema:
            type: integer
            enum: [0, 1]
            default: 0
          description: |
            Incluir impuestos:
            - 0: Excluir impuestos
            - 1: Incluir impuestos
      responses:
        '200':
          description: Reporte de ventas con la agrupación y periodicidad solicitada
          content:
            application/json:
              schema:
                type: array
                items:
                  type: object
                  description: Registro de ventas con campos dinámicos según periodicidad
  /consultar-cobros-pendientes:
    get:
      summary: Consultar cobros pendientes con filtros
      operationId: consultarCobrosPendientes
      parameters:
        - name: agrupacion
          in: query
          schema:
            type: integer
            enum: [1, 2, 3, 4, 5, 6]
            default: 1
          description: |
            Tipo de agrupación:
            - 1: Por ejecutivo
            - 2: Por grupo  
            - 3: Por línea
            - 4: Por origen
            - 5: Por país
            - 6: Por región
        - name: periodicidad
          in: query
          schema:
            type: integer
            enum: [0, 1, 2, 3, 4, 5, 6]
            default: 4
          description: |
            Periodicidad del reporte:
            - 0: Anual
            - 1: Semestral
            - 2: Trimestral
            - 3: Bimestral
            - 4: Mensual
            - 5: Quincenal
            - 6: Semanal
      responses:
        '200':
          description: Reporte de cobros pendientes agrupado según filtros
          content:
            application/json:
              schema:
                type: array
                items:
                  type: object
                  properties:
                    indice:
                      type: integer
                    idPais:
                      type: string
                    idEstado:
                      type: string
                    estado:
                      type: string
                    moneda:
                      type: string
                    vencido:
                      type: number
                      description: Monto vencido
                    _P1:
                      type: number
                      description: Período 1
                    _PF:
                      type: number
                      description: Período final
                    _TOT:
                      type: number
                      description: Total
  /consultar-prospectos-recientes:
    get:
      summary: Consultar prospectos con filtros de período y ejecutivo
      operationId: consultarProspectosRecientes
      parameters:
        - name: pagina
          in: query
          schema:
            type: integer
            minimum: 1
            default: 1
          description: Número de página para paginación
        - name: cantidadRegistros
          in: query
          schema:
            type: integer
            minimum: 1
            maximum: 100
            default: 50
          description: Cantidad de registros por página
        - name: periodo
          in: query
          schema:
            type: string
            enum: ["1", "5", "8"]
          description: |
            Filtro por período de tiempo (usar parámetros de Upnify):
            - 1: Prospectos de hoy
            - 5: Prospectos del mes actual
            - 8: Prospectos del año actual
            - Sin especificar: Todos los períodos
        - name: tkUsuario
          in: query
          schema:
            type: string
          description: |
            Filtro por ejecutivo:
            - "*": Ver prospectos de todos los ejecutivos
            - Sin especificar: Solo mis prospectos
            - Token específico: Prospectos de un ejecutivo específico
      responses:
        '200':
          description: Lista de prospectos con filtros aplicados
          content:
            application/json:
              schema:
                type: object
                properties:
                  total:
                    type: integer
                    description: Total de prospectos obtenidos
                  pagina:
                    type: integer
                    description: Página actual
                  cantidadRegistros:
                    type: integer
                    description: Registros por página
                  filtros:
                    type: object
                    properties:
                      periodo:
                        type: string
                        description: Descripción del período aplicado
                      ejecutivo:
                        type: string
                        description: Descripción del filtro de ejecutivo aplicado
                  prospectos:
                    type: array
                    items:
                      type: object
                      properties:
                        tkProspecto:
                          type: string
                          description: Token único del prospecto
                        nombre:
                          type: string
                          description: Nombre del prospecto
                        apellidos:
                          type: string
                          description: Apellidos del prospecto
                        contacto:
                          type: string
                          description: Nombre completo de contacto
                        correo:
                          type: string
                          description: Correo electrónico
                        telefono:
                          type: string
                          description: Teléfono principal
                        movil:
                          type: string
                          description: Teléfono móvil
                        fechaContacto:
                          type: string
                          format: date-time
                          description: Fecha de primer contacto
                        fechaUltimaModificacion:
                          type: string
                          format: date-time
                          description: Fecha de última modificación
                        ejecutivoNombre:
                          type: string
                          description: Nombre del ejecutivo asignado
                        ultimoContacto:
                          type: string
                          description: Descripción del último contacto
                        ultimoContactoFechaHora:
                          type: string
                          format: date-time
                          description: Fecha del último contacto
                        fase:
                          type: string
                          description: Fase actual del prospecto
                        faseColor:
                          type: string
                          description: Color de la fase
                        origen:
                          type: string
                          description: Origen del prospecto
                        pais:
                          type: string
                          description: País del prospecto
                        estado:
                          type: string
                          description: Estado/provincia del prospecto
                        empresa:
                          type: string
                          description: Empresa del prospecto
                        industria:
                          type: string
                          description: Industria o sector
                        tipo:
                          type: string
                          description: Tipo de prospecto
                        gasto:
                          type: number
                          description: Gasto estimado
                        periodo:
                          type: string
                          description: Período de gasto
                        esCliente:
                          type: integer
                          description: 1 si es cliente, 0 si no
                        descartado:
                          type: integer
                          description: 1 si está descartado, 0 si no
                        archivado:
                          type: integer
                          description: 1 si está archivado, 0 si no
