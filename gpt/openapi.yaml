openapi: 3.1.0
info:
  title: UpnifIA - API completa para Upnify CRM
  version: 1.1.0
  description: |
    API REST para gestionar Upnify CRM desde ChatGPT.
    
    üîë **IMPORTANTE**: Todos los endpoints requieren un n√∫mero identificador √∫nico que debe proporcionarse en cada petici√≥n.
    
    **Antes de usar cualquier funci√≥n, SIEMPRE pregunta al usuario por su n√∫mero identificad  /buscar-contactos:
    get:
      summary: Buscar prospectos y clientes por nombre, correo o tel√©fono
                   required: [numeroIdentificador, concepto, tkProspecto, monto, comision]
              properties:
                numeroIdentificador:
                  type: string
                  description: N√∫mero identificador √∫nico de Upnify del usuario
                  example: "P07RTgwMkQ4RUMtN0I5RC00QUMyLTlFQzMtQ0MwRDY4MzVDMLE5"tionId: buscarContactos
      parameters:
        - name: numeroIdentificador
          in: query
          required: true
          schema:
            type: string
          description: N√∫mero identificador √∫nico de Upnify del usuario
          example: "P07RTgwMkQ4RUMtN0I5RC00QUMyLTlFQzMtQ0MwRDY4MzVDMTE5".**
    
    El usuario puede obtener su n√∫mero identificador desde:
    - Su cuenta de Upnify ‚Üí Configuraci√≥n ‚Üí API
    
    Ejemplo: "Para poder ayudarte, necesito tu n√∫mero identificador de Upnify. Puedes encontrarlo en tu cuenta de Upnify en Configuraci√≥n > API. Por favor comp√°rtelo conmigo."
servers:
  - url: https://upnifia-production.up.railway.app
paths:
  /crear-prospecto-completo:
    post:
      summary: Crear prospecto en Upnify CRM con datos b√°sicos
      description: Crea un nuevo prospecto con informaci√≥n esencial. Los campos adicionales (empresa, puesto, etiquetas, fase, etc.) se asignan autom√°ticamente con valores por defecto de Upnify.
      operationId: crearProspectoCompleto
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [numeroIdentificador, nombre, apellidos, correo]
              properties:
                numeroIdentificador:
                  type: string
                  description: N√∫mero identificador √∫nico de Upnify del usuario (solicitar al usuario)
                  example: "P07RTgwMkQ4RUMtN0I5RC00QUMyLTlFQzMtQ0MwRDY4MzVDMTE5"
                nombre:
                  type: string
                  description: Nombre del prospecto
                  example: "Juan Carlos"
                apellidos:
                  type: string
                  description: Apellidos del prospecto
                  example: "Garc√≠a L√≥pez"
                correo:
                  type: string
                  format: email
                  description: Correo electr√≥nico del prospecto
                  example: "juan.garcia@empresa.com"
                empresa:
                  type: string
                  description: Empresa donde trabaja el prospecto (opcional pero recomendado)
                  example: "Tecnolog√≠a Avanzada SA"
                puesto:
                  type: string
                  description: Cargo o puesto que ocupa en la empresa (opcional)
                  example: "Gerente de Ventas"
                movil:
                  type: string
                  description: Tel√©fono m√≥vil (opcional, formato internacional recomendado)
                  example: "+525512345678"
              additionalProperties: false
              additionalProperties: false
      responses:
        '200':
          description: Prospecto creado exitosamente
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    description: Indica si la creaci√≥n fue exitosa
                  status:
                    type: integer
                    description: C√≥digo de estado HTTP
                  message:
                    type: string
                    description: Mensaje de confirmaci√≥n
                  prospecto:
                    type: object
                    description: Datos del prospecto creado
        '400':
          description: Datos inv√°lidos o campos obligatorios faltantes
        '409':
          description: El prospecto ya existe (email duplicado)
  /consultar-ventas:
    get:
      summary: Consultar reportes de ventas con filtros flexibles
      operationId: consultarVentas
      parameters:
        - name: numeroIdentificador
          in: query
          required: true
          schema:
            type: string
          description: N√∫mero identificador √∫nico de Upnify del usuario
          example: "P07RTgwMkQ4RUMtN0I5RC00QUMyLTlFQzMtQ0MwRDY4MzVDMTE5"
        - name: agrupacion
          in: query
          schema:
            type: integer
            enum: [1, 2, 3, 4, 5, 6, 17]
            default: 1
          description: |
            Tipo de agrupaci√≥n:
            - 1: Por ejecutivo
            - 2: Por grupo  
            - 3: Por l√≠nea
            - 4: Por origen
            - 5: Por pa√≠s
            - 6: Por regi√≥n
            - 17: Por industria
        - name: periodicidad
          in: query
          schema:
            type: integer
            enum: [1, 2, 3, 4, 5, 6]
            default: 4
          description: |
            Periodicidad del reporte:
            - 1: Semestral
            - 2: Trimestral
            - 3: Bimestral
            - 4: Mensual
            - 5: Quincenal
            - 6: Semanal
        - name: anio
          in: query
          schema:
            type: integer
            minimum: 2009
            maximum: 2025
            default: 2025
          description: A√±o a consultar (2009-2025)
        - name: impuestos
          in: query
          schema:
            type: integer
            enum: [0, 1]
            default: 0
          description: |
            Incluir impuestos:
            - 0: Excluir impuestos
            - 1: Incluir impuestos
      responses:
        '200':
          description: Reporte de ventas con la agrupaci√≥n y periodicidad solicitada
          content:
            application/json:
              schema:
                type: array
                items:
                  type: object
                  description: Registro de ventas con campos din√°micos seg√∫n periodicidad
  /consultar-cobros-pendientes:
    get:
      summary: Consultar cobros pendientes con filtros
      operationId: consultarCobrosPendientes
      parameters:
        - name: numeroIdentificador
          in: query
          required: true
          schema:
            type: string
          description: N√∫mero identificador √∫nico de Upnify del usuario
          example: "P07RTgwMkQ4RUMtN0I5RC00QUMyLTlFQzMtQ0MwRDY4MzVDMTE5"
        - name: agrupacion
          in: query
          schema:
            type: integer
            enum: [1, 2, 3, 4, 5, 6]
            default: 1
          description: |
            Tipo de agrupaci√≥n:
            - 1: Por ejecutivo
            - 2: Por grupo  
            - 3: Por l√≠nea
            - 4: Por origen
            - 5: Por pa√≠s
            - 6: Por regi√≥n
        - name: periodicidad
          in: query
          schema:
            type: integer
            enum: [0, 1, 2, 3, 4, 5, 6]
            default: 4
          description: |
            Periodicidad del reporte:
            - 0: Anual
            - 1: Semestral
            - 2: Trimestral
            - 3: Bimestral
            - 4: Mensual
            - 5: Quincenal
            - 6: Semanal
      responses:
        '200':
          description: Reporte de cobros pendientes agrupado seg√∫n filtros
          content:
            application/json:
              schema:
                type: array
                items:
                  type: object
                  properties:
                    indice:
                      type: integer
                    idPais:
                      type: string
                    idEstado:
                      type: string
                    estado:
                      type: string
                    moneda:
                      type: string
                    vencido:
                      type: number
                      description: Monto vencido
                    _P1:
                      type: number
                      description: Per√≠odo 1
                    _PF:
                      type: number
                      description: Per√≠odo final
                    _TOT:
                      type: number
                      description: Total
  /consultar-prospectos-recientes:
    get:
      summary: Consultar prospectos con filtros de per√≠odo y ejecutivo
      operationId: consultarProspectosRecientes
      parameters:
        - name: numeroIdentificador
          in: query
          required: true
          schema:
            type: string
          description: N√∫mero identificador √∫nico de Upnify del usuario
          example: "P07RTgwMkQ4RUMtN0I5RC00QUMyLTlFQzMtQ0MwRDY4MzVDMTE5"
        - name: pagina
          in: query
          schema:
            type: integer
            minimum: 1
            default: 1
          description: N√∫mero de p√°gina para paginaci√≥n
        - name: cantidadRegistros
          in: query
          schema:
            type: integer
            minimum: 1
            maximum: 100
            default: 50
          description: Cantidad de registros por p√°gina
        - name: periodo
          in: query
          schema:
            type: string
            enum: ["1", "5", "8"]
          description: |
            Filtro por per√≠odo de tiempo (usar par√°metros de Upnify):
            - 1: Prospectos de hoy
            - 5: Prospectos del mes actual
            - 8: Prospectos del a√±o actual
            - Sin especificar: Todos los per√≠odos
        - name: tkUsuario
          in: query
          schema:
            type: string
          description: |
            Filtro por ejecutivo:
            - "*": Ver prospectos de todos los ejecutivos
            - Sin especificar: Solo mis prospectos
            - Token espec√≠fico: Prospectos de un ejecutivo espec√≠fico
      responses:
        '200':
          description: Lista de prospectos con filtros aplicados
          content:
            application/json:
              schema:
                type: object
                properties:
                  total:
                    type: integer
                    description: Total de prospectos obtenidos
                  pagina:
                    type: integer
                    description: P√°gina actual
                  cantidadRegistros:
                    type: integer
                    description: Registros por p√°gina
                  filtros:
                    type: object
                    properties:
                      periodo:
                        type: string
                        description: Descripci√≥n del per√≠odo aplicado
                      ejecutivo:
                        type: string
                        description: Descripci√≥n del filtro de ejecutivo aplicado
                  prospectos:
                    type: array
                    items:
                      type: object
                      properties:
                        tkProspecto:
                          type: string
                          description: Token √∫nico del prospecto
                        nombre:
                          type: string
                          description: Nombre del prospecto
                        apellidos:
                          type: string
                          description: Apellidos del prospecto
                        contacto:
                          type: string
                          description: Nombre completo de contacto
                        correo:
                          type: string
                          description: Correo electr√≥nico
                        telefono:
                          type: string
                          description: Tel√©fono principal
                        movil:
                          type: string
                          description: Tel√©fono m√≥vil
                        fechaContacto:
                          type: string
                          format: date-time
                          description: Fecha de primer contacto
                        fechaUltimaModificacion:
                          type: string
                          format: date-time
                          description: Fecha de √∫ltima modificaci√≥n
                        ejecutivoNombre:
                          type: string
                          description: Nombre del ejecutivo asignado
                        ultimoContacto:
                          type: string
                          description: Descripci√≥n del √∫ltimo contacto
                        ultimoContactoFechaHora:
                          type: string
                          format: date-time
                          description: Fecha del √∫ltimo contacto
                        fase:
                          type: string
                          description: Fase actual del prospecto
                        faseColor:
                          type: string
                          description: Color de la fase
                        origen:
                          type: string
                          description: Origen del prospecto
                        pais:
                          type: string
                          description: Pa√≠s del prospecto
                        estado:
                          type: string
                          description: Estado/provincia del prospecto
                        empresa:
                          type: string
                          description: Empresa del prospecto
                        industria:
                          type: string
                          description: Industria o sector
                        tipo:
                          type: string
                          description: Tipo de prospecto
                        gasto:
                          type: number
                          description: Gasto estimado
                        periodo:
                          type: string
                          description: Per√≠odo de gasto
                        esCliente:
                          type: integer
                          description: 1 si es cliente, 0 si no
                        descartado:
                          type: integer
                          description: 1 si est√° descartado, 0 si no
                        archivado:
                          type: integer
                          description: 1 si est√° archivado, 0 si no
  /buscar-contactos:
    get:
      summary: Buscar prospectos y clientes por nombre, correo o tel√©fono
      operationId: buscarContactos
      parameters:
        - name: tkSesion
          in: query
          required: true
          schema:
            type: string
          description: Token de sesi√≥n de Upnify del usuario
          example: "P07RTgwMkQ4RUMtN0I5RC00QUMyLTlFQzMtQ0MwRDY4MzVDMTE5"
        - name: buscar
          in: query
          required: true
          schema:
            type: string
          description: T√©rmino de b√∫squeda (nombre, correo, tel√©fono)
        - name: cantidadRegistros
          in: query
          schema:
            type: integer
            minimum: 1
            maximum: 50
            default: 10
          description: Cantidad m√°xima de registros a devolver
      responses:
        '200':
          description: Resultados de b√∫squeda de contactos
          content:
            application/json:
              schema:
                type: object
                properties:
                  termino:
                    type: string
                    description: T√©rmino de b√∫squeda utilizado
                  total:
                    type: integer
                    description: Total de contactos encontrados
                  resumen:
                    type: object
                    properties:
                      prospectos:
                        type: integer
                        description: Cantidad de prospectos encontrados
                      clientes:
                        type: integer
                        description: Cantidad de clientes encontrados
                  contactos:
                    type: array
                    items:
                      type: object
                      properties:
                        seccion:
                          type: string
                          enum: ["prospectos", "clientes"]
                          description: Tipo de contacto
                        tkProspecto:
                          type: string
                          description: Token √∫nico del contacto
                        contacto:
                          type: string
                          description: Nombre completo del contacto
                        correo:
                          type: string
                          description: Correo electr√≥nico
                        telefono:
                          type: string
                          description: Tel√©fono principal
                        movil:
                          type: string
                          description: Tel√©fono m√≥vil
                        ejecutivo:
                          type: string
                          description: Nombre del ejecutivo asignado
                        ejecutivoIniciales:
                          type: string
                          description: Iniciales del ejecutivo
                        empresa:
                          type: string
                          description: Empresa del contacto
                        id:
                          type: string
                          description: Identificador √∫nico del contacto
                  mensaje:
                    type: string
                    description: Mensaje informativo sobre los resultados
  /crear-oportunidad:
    post:
      summary: Crear oportunidad para un prospecto
      operationId: crearOportunidad
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [tkSesion, concepto, tkProspecto, monto, comision]
              properties:
                tkSesion:
                  type: string
                  description: Token de sesi√≥n de Upnify del usuario
                  example: "P07RTgwMkQ4RUMtN0I5RC00QUMyLTlFQzMtQ0MwRDY4MzVDMTE5"
                concepto:
                  type: string
                  description: Descripci√≥n de la oportunidad
                  example: "Subscripci√≥n Netflix"
                tkProspecto:
                  type: string
                  description: Token del prospecto para quien crear la oportunidad
                  example: "P-10153545-234C-4C10-B666-8877D29433CA"
                monto:
                  type: number
                  minimum: 0
                  description: Monto de la oportunidad
                  example: 100
                comision:
                  type: number
                  minimum: 0
                  maximum: 1
                  description: Porcentaje de comisi√≥n (0.05 = 5%)
                  example: 0.05
      responses:
        '200':
          description: Oportunidad creada exitosamente
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    description: Indica si la creaci√≥n fue exitosa
                  status:
                    type: integer
                    description: C√≥digo de estado HTTP
                  oportunidad:
                    type: array
                    items:
                      type: object
                      properties:
                        code:
                          type: integer
                        msg:
                          type: string
                        details:
                          type: array
                          items:
                            type: object
                            properties:
                              tkOportunidad:
                                type: string
                                description: Token de la oportunidad creada
                  detalles:
                    type: object
                    properties:
                      concepto:
                        type: string
                      monto:
                        type: number
                      comision:
                        type: number
                      comisionMonto:
                        type: number
                        description: Monto de comisi√≥n calculado autom√°ticamente
                      tkProspecto:
                        type: string
